# 压测
压测的问题,可以聊的点很多,从软件、硬件、网络、框架等等方向。下面简单介绍个人是如何准备压测

## 例如: 抽奖系统中的抽奖接口,可支持多少QPS

### 环境准备
- 服务器
- 数据库
- redis
- mq(一般跳过)
- 压测工具(Jmeter,python脚本)
- 抓包工具(wireshark)
- 链路追踪工具(skywalking)

### 测试点准备
> 从开发的角度进行测试,与测试的角度测试方向是不一样的。明确此次测试需要达成的目标

此次需要达到标准,单接口QPS。

### 框架接口性能
特别是第一次尝试的框架以及准备上生产的项目,一定要进行压测。例如SpringCloud,虽然火,但其实性能很拉胯。
通过各种调优参数以及配置的修改,才可应付生产环境。

#### 空载性能 
使用空接口(无业务相关)压测, 看看最高可达上限

#### 业务接口压测
使用业务接口进行压测,同时观察服务器(cpu,内存)。以及数据库的负载等等

#### 业务接口分析以及优化
理论上说,代码都是有不少优化空间,可邀请同事一并参与讨论。

#### 不要急着扩容
如果单台服务器的性能,数据库等等都未出现瓶颈，考虑是否框架自身存在性能瓶颈,可进行参数调优。

例如scg作为网关时候,转发路由存在性能问题。SpringBoot默认的tomcat连接数等等都是有优化空间等

#### 横向扩容
扩容服务器,采取双倍扩容。横向对比,QPS的增加是否如预期。

### 循序渐进
逐步增加压测接口,例如100->200->600->1000往上叠加。再根据日志,以及可视化控制台分析问题。

## 耐心
压测调优属于一个漫长地学习过程,很可能会颠覆开发人员认知。感觉自己平时写代码没问题,一压测就是各种问题频发。



